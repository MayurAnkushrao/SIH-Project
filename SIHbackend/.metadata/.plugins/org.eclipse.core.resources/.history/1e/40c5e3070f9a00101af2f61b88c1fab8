package com.sih.SIHbackend.serviceImpl;

import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;

import com.sih.SIHbackend.entity.SentimentAnalysis;
import com.sih.SIHbackend.service.SentimentService;

import jakarta.transaction.Transactional;

@Service
@Transactional
public class SentimentServiceImpl implements SentimentService {
    
    // Integrate with your friend's sentiment analysis model
    @Autowired
    private RestTemplate restTemplate;
    
    public SentimentAnalysis analyzeSentiment(Long postId) {
        List<Comment> comments = commentRepository.findByPostId(postId);
        
        // Call your ML model API
        List<String> commentTexts = comments.stream()
            .map(Comment::getContent)
            .collect(Collectors.toList());
            
        // API call to sentiment analysis service
        SentimentRequest mlRequest = new SentimentRequest(commentTexts);
        ResponseEntity<SentimentMLResponse> mlResponse = 
            restTemplate.postForEntity("http://localhost:8080/ml/sentiment", mlRequest, SentimentMLResponse.class);
        
        // Process results and save to database
        return processSentimentResults(postId, comments, mlResponse.getBody());
    }
}
